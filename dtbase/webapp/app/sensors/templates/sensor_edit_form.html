{% extends "base_site.html" %}

{% block title %} DTBase {% endblock title %}

{% block sidebar %} {# Omit the sidebar content #} {% endblock sidebar %}

{% block content %}
<div class="col-12 mt-5 ms-5">
    <h3 style="margin-bottom: 15px;">Edit Sensor</h2>

    <p style = "margin-bottom: 5px;"><strong>You are editing:</strong></p>
    {% for key, value in all_args.items() %}
        <p style="margin-bottom: 1px; margin-left: 20px"> - {{ key }}: {{ value }}</p>
    {% endfor %}

    <form style="margin-top: 15px" id="edit-sensor-form" method="POST">
        <div class="form-group">
            <label for="name">Name:</label>
            <input type="text" class="form-control custom-input" id="name" name="name" required value="{{all_args['name']}}">
            <label for="notes">Notes:</label>
            <input type="text" class="form-control custom-input" id="notes" name="notes" required value="{{all_args['notes']}}">
        </div>
        <button type="submit" class="btn btn-primary btn-margin">Submit</button>
        <button type="button" class="btn btn-warning btn-margin" formnovalidate onclick="closeEditModal()">Cancel</button>
        <button type="button" class="btn btn-danger btn-margin" formnovalidate onclick="deleteSensor()">Delete</button>
    </form>
</div>
{% endblock content %}

{% block javascripts %}
{{ super() }}
<script>
    function closeEditModal() {
        // close the popup window or perform any other close action
        window.close();
    }

    function deleteSensor() {
        // Perform the delete action, e.g., show a confirmation dialog
        if (confirm("Are you sure you want to delete this sensor?")) {
            // Delete the sensor
            fetch(window.location.href,{
                method: 'DELETE',
            }).then(function(response) {
                if (response.ok) {
                    // If the sensor was deleted successfully, close the popup window
                    window.close();
                } else {
                    // If the sensor was not deleted successfully, show an alert
                    alert("Sensor not deleted");
                }
            });
        } else {
            // Do nothing
            alert("Sensor not deleted");
        }
    }

    document.getElementById('edit-sensor-form').addEventListener('submit', function(e) {
        e.preventDefault(); // prevent the form from submitting normally

        let url = e.target.action; // get the form's action URL
        let formData = new FormData(e.target); // get the form data

        // send the form data to the server
        fetch(url, {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (!response.ok) {
            throw new Error('Network response was not ok');
            }
        })
        .then(data => {
            // handle success - close the window if the submission was successful
            window.close();
        })
        .catch(error => {
            // handle error - don't close the window if there was an error
            console.error('Error:', error);
        });
    });
   </script>
{% endblock javascripts %}
